- name: ADT Download
  hosts: all
  tasks:
    - name: Create directory for artifactory download
      file:
        path: "{{ artifactory_download_directory }}/{{ item.rsplit('/', 1)[0] }}"
        state: directory
      with_items:
           - "{{ artifactory_repository_path.split(',') }}"
  tasks:
    - name: Download from Artifactory
      get_url:
        url: "{{ ARTIFACTORY_HOSTNAME }}/artifactory/{{ artifactory_repository_path }}"
        dest: "{{ artifactory_download_directory }}"
        headers:
           X-JFrog-Art-Api: "{{ ARTIFACTORY_API_TOKEN }}"
      with_items:
           - "{{ artifactory_repository_path.split(',') }}"
- name: ADT Deployment
  hosts: all
  tasks:
     - name: Message from the {{ tower_inventory_name }} environment
      debug:
        msg: "Deploying application "
